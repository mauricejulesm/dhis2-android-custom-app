# Error in fileResource upload does not prevent TEI update (ANDROSDK-1452)

UPDATE Event SET syncState = 'TO_UPDATE', aggregatedSyncState = 'TO_UPDATE' WHERE uid IN (SELECT dv.event FROM TrackedEntityDataValue dv INNER JOIN FileResource fr ON dv.value = fr.uid INNER JOIN DataElement de ON dv.dataElement = de.uid WHERE fr.syncState != 'SYNCED' AND de.valueType IN ('IMAGE', 'FILE_RESOURCE')) AND aggregatedSyncState NOT IN ('RELATIONSHIP', 'ERROR', 'WARNING');
UPDATE Enrollment SET aggregatedSyncState = 'TO_UPDATE' WHERE uid IN (SELECT ev.enrollment FROM Event ev INNER JOIN TrackedEntityDataValue dv ON ev.uid = dv.event INNER JOIN FileResource fr ON dv.value = fr.uid INNER JOIN DataElement de ON dv.dataElement = de.uid WHERE fr.syncState != 'SYNCED' AND de.valueType IN ('IMAGE', 'FILE_RESOURCE')) AND aggregatedSyncState NOT IN ('RELATIONSHIP', 'ERROR', 'WARNING');
UPDATE TrackedEntityInstance SET aggregatedSyncState = 'TO_UPDATE' WHERE uid IN (SELECT en.trackedEntityInstance FROM Enrollment en INNER JOIN Event ev ON en.uid = ev.enrollment INNER JOIN TrackedEntityDataValue dv ON ev.uid = dv.event INNER JOIN FileResource fr ON dv.value = fr.uid INNER JOIN DataElement de ON dv.dataElement = de.uid WHERE fr.syncState != 'SYNCED' AND de.valueType IN ('IMAGE', 'FILE_RESOURCE')) AND aggregatedSyncState NOT IN ('RELATIONSHIP', 'ERROR', 'WARNING');

UPDATE TrackedEntityInstance SET syncState = 'TO_UPDATE', aggregatedSyncState = 'TO_UPDATE' WHERE uid IN (SELECT teav.trackedEntityInstance FROM TrackedEntityAttributeValue teav INNER JOIN FileResource fr ON teav.value = fr.uid INNER JOIN TrackedEntityAttribute tea ON teav.trackedEntityAttribute = tea.uid WHERE fr.syncState != 'SYNCED' AND tea.valueType IN ('IMAGE', 'FILE_RESOURCE')) AND aggregatedSyncState NOT IN ('RELATIONSHIP', 'ERROR', 'WARNING');